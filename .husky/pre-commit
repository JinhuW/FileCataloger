#!/usr/bin/env sh

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "üîç Pre-commit hook: Running code quality checks..."

# Check if native modules need rebuilding
echo "‚öôÔ∏è  Checking native module status..."
if ! yarn native:check 2>/dev/null; then
  echo -e "${YELLOW}‚ö†Ô∏è  Native modules check skipped (script not yet implemented)${NC}"
fi

# Run lint-staged for incremental checks
echo "üìù Running lint-staged..."
npx lint-staged

# Check for TypeScript errors across entire project
echo "üîé Running full TypeScript type checking..."
if ! yarn typecheck; then
  echo -e "${RED}‚ùå TypeScript type checking failed${NC}"
  echo "Please fix type errors before committing."
  exit 1
fi

# Run renderer validation (hooks, imports, etc)
echo "üéØ Validating renderer code..."
if ! yarn validate:renderer; then
  echo -e "${RED}‚ùå Renderer validation failed${NC}"
  echo "Please fix renderer issues before committing."
  exit 1
fi

# Check for security issues in Electron main process
echo "üîê Checking Electron security..."
if ! yarn security:check 2>/dev/null; then
  echo -e "${YELLOW}‚ö†Ô∏è  Security check skipped (script not yet implemented)${NC}"
fi

# Validate documentation
echo "üìö Validating documentation..."
if ! yarn docs:validate 2>/dev/null; then
  echo -e "${YELLOW}‚ö†Ô∏è  Documentation validation skipped (script not yet implemented)${NC}"
fi

# Check for dependency issues
echo "üì¶ Checking dependencies..."
if ! yarn deps:check 2>/dev/null; then
  echo -e "${YELLOW}‚ö†Ô∏è  Dependency check skipped (script not yet implemented)${NC}"
fi

echo -e "${GREEN}‚úÖ Pre-commit checks passed!${NC}"
